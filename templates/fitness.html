{% extends "base.html" %}

{% block title %}Fitness - Smart Fitness Tracker{% endblock %}

{% block content %}
<div class="fitness-container">
    <div class="page-header">
        <h2>Fitness Tracking</h2>
    </div>
    
    <div class="fitness-grid">
        <div class="fitness-form-section">
            <h3>Log Activity</h3>
            
            <div class="form-group">
                <label for="activityType">Activity Type</label>
                <select id="activityType">
                    <option value="">Select an activity...</option>
                    <option value="Running">Running</option>
                    <option value="Walking">Walking</option>
                    <option value="Cycling">Cycling</option>
                    <option value="Swimming">Swimming</option>
                    <option value="Football">Football</option>
                    <option value="Cricket">Cricket</option>
                    <option value="Gym">Gym</option>
                    <option value="Yoga">Yoga</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="duration">Duration (minutes)</label>
                <input 
                    type="number" 
                    id="duration" 
                    placeholder="Enter duration in minutes"
                    min="1"
                    max="300">
            </div>
            
            <button id="addActivityBtn" class="btn btn-primary">Log Activity</button>
            <div id="activityMessage" class="message" style="display: none;"></div>
        </div>
        
        <div class="fitness-logs-section">
            <h3>Today's Workouts</h3>
            <div class="fitness-summary">
                <div class="summary-item">
                    <span>Total Calories Burned:</span>
                    <strong id="totalCaloriesBurned">0</strong> kcal
                </div>
                <div class="summary-item">
                    <span>Total Duration:</span>
                    <strong id="totalDuration">0</strong> min
                </div>
            </div>
            
            <div id="fitnessLogsList" class="logs-list">
                <p class="no-data">No activities logged yet</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Add activity
    document.getElementById('addActivityBtn').addEventListener('click', async () => {
        const activity = document.getElementById('activityType').value;
        const duration = parseInt(document.getElementById('duration').value);
        const message = document.getElementById('activityMessage');
        
        if (!activity) {
            message.textContent = 'Please select an activity';
            message.className = 'message error';
            message.style.display = 'block';
            return;
        }
        
        if (!duration || duration < 1) {
            message.textContent = 'Please enter a valid duration';
            message.className = 'message error';
            message.style.display = 'block';
            return;
        }
        
        try {
            const response = await fetch('/api/add-fitness', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    activity_type: activity,
                    duration: duration
                })
            });
            
            if (response.ok) {
                const data = await response.json();
                message.textContent = `âœ“ Logged ${activity} for ${duration} min (${Math.round(data.calories_burned)} kcal)`;
                message.className = 'message success';
                message.style.display = 'block';
                
                document.getElementById('activityType').value = '';
                document.getElementById('duration').value = '';
                
                setTimeout(() => {
                    message.style.display = 'none';
                    loadFitnessLogs();
                }, 2000);
            }
        } catch (error) {
            console.error('Error adding activity:', error);
            message.textContent = 'Error logging activity';
            message.className = 'message error';
            message.style.display = 'block';
        }
    });
    
    async function deleteFitnessLog(id) {
        if (!confirm('Delete this activity?')) return;
        try {
            const response = await fetch(`/api/delete-fitness/${id}`, { method: 'DELETE' });
            if (response.ok) {
                loadFitnessLogs();
            }
        } catch (error) {
            console.error('Error deleting fitness log:', error);
        }
    }
    
    async function loadFitnessLogs() {
        try {
            const response = await fetch('/api/fitness-logs');
            const logs = await response.json();
            
            const logsList = document.getElementById('fitnessLogsList');
            
            if (logs.length === 0) {
                logsList.innerHTML = '<p class="no-data">No activities logged yet</p>';
            } else {
                logsList.innerHTML = logs.map(log => 
                    `<div class="log-item">
                        <div class="log-header">
                            <div>
                                <strong>${log.activity_type}</strong>
                                <span class="activity-time">${log.duration} min</span>
                            </div>
                            <button class="delete-btn" onclick="deleteFitnessLog(${log.id})" title="Delete">âœ•</button>
                        </div>
                        <div class="log-calories">
                            ðŸ”¥ ${Math.round(log.calories_burned)} kcal burned
                        </div>
                    </div>`
                ).join('');
            }
            
            // Calculate totals
            const totalCalories = logs.reduce((sum, log) => sum + log.calories_burned, 0);
            const totalDuration = logs.reduce((sum, log) => sum + log.duration, 0);
            
            document.getElementById('totalCaloriesBurned').textContent = Math.round(totalCalories);
            document.getElementById('totalDuration').textContent = totalDuration;
        } catch (error) {
            console.error('Error loading fitness logs:', error);
        }
    }
    
    // Load logs on page load
    loadFitnessLogs();
    
    // Reload every 5 seconds
    setInterval(loadFitnessLogs, 5000);
</script>
{% endblock %}
